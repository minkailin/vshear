\section{Governing equations and disk models}\label{setup}
We consider  an inviscid, non-self-gravitating three-dimensional (3D)
disk orbiting a central star of mass $M_*$. We adopt cylindrical
co-ordinates $(r,\phi, z)$ centered on the star to describe the global
disk. The governing fluid equations are
\begin{align}
  &\frac{\p\rho}{\p t} + \nabla\cdot{\left(\rho\bm{v}\right)} = 0,\\
  &\frac{\p\bm{v}}{\p t} + \bm{v}\cdot\nabla\bm{v} =
  -\frac{1}{\rho}\nabla P - \nabla\Phi_*,\\
  &\frac{\p P}{\p t} + \bm{v}\cdot\nabla P  = - \gamma P
  \nabla\cdot\bm{v} - \Lambda % \frac{\rho}{t_c}\left(\frac{P}{\rho} -
    % \left.\frac{P}{\rho}\right|_{t=0}\right)
  , \label{full_energy}
\end{align}
where $\rho$ is the mass density, $\bm{v}$ is the velocity field (the
rotation frequency being $\Omega=v_\phi/r$), $P$
is the pressure, $\gamma$ is the constant adiabatic index, and $\Phi_*
= -GM_*(r^2 + z^2)^{-1/2}$ is the gravitational potential of the
central star and $G$ is the gravitational constant. 
In the energy equation (Eq. \ref{full_energy}) the source term
$\Lambda$ represent non-adiabatic effects which we
model below. The gas temperature $T$ is defined through the ideal gas 
equation of state,  
\begin{align}
P = \frac{\mathcal{R}}{\mu}\rho T,
\end{align}
where $\mathcal{R}$ is the gas constant and $\mu$ is the mean molecular
weight.    

\subsection{Thermal relaxation}
We model non-adiabatic effects by defining $\Lambda$ as a thermal
relaxation term,
\begin{align}\label{thermal_relax}
  \Lambda  \equiv \frac{\rho\mathcal{R}}{\mu t_c}\left(T - T_0\right),
\end{align}
where $T_0=T_0(r,z)$ is the initial temperature, and $t_c$ is a
thermal relaxation timescale parametrized via $\beta$ such that 
\begin{align}\label{beta_def}
  t_c = \beta \Omega_k^{-1},
\end{align}
where $\Omega_k=\sqrt{GM_*/r^3}$ is the Keplerian frequency.   

For most of this paper we will take $\beta$ as a constant input
parameter, so that we can vary the thermodynamic response of the
disk from isothermal ($\beta\ll 1$) to adiabatic ($\beta \gg 1$) in a
controlled manner. However, for application to protoplanetary disks in 
\S\ref{application} we will model $\beta$ based on physical thermal
timescales, in which case $\beta$ is non-constant and is determined by
the equilibrium disk properties and the perturbation length-scales of
interest.   

\subsection{Baroclinic disk equilibria}\label{eqm}
The equilibrium disk is steady and axisymmetric with density,
pressure and rotation profiles $\rho(r,z)$, $P(r,z)$ and
$\Omega(r,z)$, respectively. These functions satisfy  
\begin{align}
  0 &= \frac{1}{\rho}\frac{\p P}{\p z} + \frac{\p \Phi_*}{\p z},\label{vert_equilibrium}\\
  r\Omega^2&= \frac{1}{\rho}\frac{\p P}{\p r} + \frac{\p \Phi_*}{\p
    r}.\label{hori_equilibrium} 
\end{align} 
These equations allows us to choose any mid-plane density 
distribution $\rho_0(r)\equiv \rho(r,0)$. In this work we assume a
power-law profile, 
\begin{align}
  \rho_0(r) = \rho_{00}\left(\frac{r}{r_0}\right)^p,
\end{align}
where $\rho_{00}$ is the midplane density at the fiducial radius
$r=r_0$ and $p$ is the power-law index.  

We consider disk equilibria in which the pressure $P$ and density
$\rho$ are related by   
\begin{align}
  P(r,z) &= 
  \frac{c_{s0}^2(r)}{\Gamma}\rho_0(r)^{1-\Gamma}\rho^\Gamma(r,z),\notag\\
  & \equiv K(r)\rho^{\Gamma}(r,z). \label{eqm_press}
\end{align}
where the polytropic index $\Gamma$ is a  constant parameter  and the
function $c_{s0}(r)$ is prescribed below. Choosing $\Gamma=1$ gives  a 
locally vertically isothermal disk and $c_{s0}(r)$ is the mid-plane
sound-speed. 
It shall be convenient to define the function $c_s(r,z)$ 
\begin{align}
  c_s^2\equiv % \frac{dP}{d\rho} =
  c_{s0}^2(r)\left(\frac{\rho}{\rho_0}\right)^{\Gamma-1} =
  \frac{\Gamma P}{\rho}, 
\end{align}
which is related to the isothermal sound-speed $c_\mathrm{iso} =
c_s/\sqrt{\Gamma}$. We take $c_{s0}(r)$ to be another power-law:  
\begin{align}
  c_{s0}^2(r)=c_{s00}^2\left(\frac{r}{r_0}\right)^q, 
\end{align}
where $c_{s00}\equiv c_{s0}(r_0)$  and $q$ is the power-law index, and
define   
\begin{align}
  \epsilon(r) \equiv \frac{c_{s0}(r)}{v_k(r)} \equiv
  \frac{H}{r} 
\end{align}
to parametrize the magnitude of the sound-speed, where
$v_k=r\Omega_k$ is the Keplerian azimuthal velocity and
$H$ is a characteristic scale-height.  Thus, $\epsilon$
is also a characteristic disk aspect-ratio. We are 
interested in thin disks with $\epsilon \ll 1$.%,%  as relevant for
% protoplanetary disks \citep{chiang97}.   

For discussion purposes it is useful to define the vertical buoyancy
frequency $N_z$ via
\begin{align}
  N_z^2 \equiv - c_p^{-1}g_z \frac{\p S}{\p z} = c_s^2 \left(\frac{\gamma -
      \Gamma}{\gamma}\right)\left(\frac{\p\ln\rho}{\p z}\right)^2,   \label{nzsq_def}
\end{align}
where $c_p$ is the heat capacity at constant pressure, $g_z\equiv
\rho^{-1}\p_zP $ and $S\equiv c_p\ln{P^{1/\gamma}/\rho}$ is the
specific entropy. The second equality applies to the disk equilibria
described above. 
We are interested in
neutrally or sub-adiabatically stratified 
disks with $\Gamma\leq \gamma$ so that $N_z^2\geq0$.  

%\subsection{Vertical structure}

Solving the equilibrium disk equations, we find the explicit
expression for the density field for 
$\Gamma\neq1$ is given  by
\begin{align}\label{eqm_dens}
  &\left(\frac{\rho}{\rho_0}\right)^{\Gamma-1} = 1 +
  \frac{\left(\Gamma-1\right)}{\epsilon^2}\left(\frac{1}{\sqrt{1+z^2/r^2}}-1\right).
\end{align}
Note that for $\Gamma > 1 + \epsilon^2$ there is a disk surface $H_s$
such that $\rho(r,H_s)=0$. 
% Note that for $\Gamma\neq1$ the disk has a surface $z=H(r)$ such that
% $\rho(r,H)=0$. If we parametrize
% \begin{align}
%   H(r)\equiv h r,
% \end{align}
% then the imposed sound-speed and disk thickness are related by 
% \begin{align}
%   h^2(r) = \left[1-\frac{\epsilon^2(r)}{\Gamma-1}\right]^{-2}-1. 
% \end{align}

Similarly, the equilibrium rotation is 
\begin{align}\label{eqm_rot}
  \frac{\Omega^2(r,z)}{\Omega_k^2(r)}=1 +
  \left(p+\frac{s}{\Gamma}\right)\epsilon^2(r) 
  +\frac{s}{\Gamma} \left(1-\frac{1}{\sqrt{1+z^2/r^2}}\right), 
\end{align}
where $s\equiv q+p(1-\Gamma)$. We also define % the radial shear rate  
% \begin{align}
%   S(r,z) \equiv r\frac{\p\Omega}{\p r},  
% \end{align}
% and
the square of the epicyclic frequency $\kappa$ 
\begin{align}
  \kappa^2(r,z) \equiv \frac{1}{r^3}\frac{\p }{\p
    r}\left(r^4\Omega^2\right). %2\Omega(2\Omega + S). 
\end{align}


\subsubsection{Vertically isothermal disks}
For $\Gamma=1$ the equilibrium density $\rho(r,z)$ and rotation
$\Omega(r,z)$ are given by 
\begin{align}
  \frac{\rho(r,z)}{\rho_0(r)} &=
  \exp{\left[\frac{1}{\epsilon^2}\left(\frac{1}{\sqrt{1+z^2/r^2}}-1\right)\right]}\\    
  \frac{\Omega^2(r,z)}{\Omega_k^2(r)}& =1+ (p+q)\epsilon^2(r) + q\left(1 -
    \frac{1}{\sqrt{1+z^2/r^2}}\right),\label{vertiso_eqm}
\end{align}
which may be obtained from Eq. \ref{eqm_dens} and Eq. \ref{eqm_rot} by
taking the limit $\Gamma\to 1$. We will, in fact, primarily focus on
vertically isothermal disks which is the relevant case for passively irradiated
protoplanetary disks \citep{chiang97}. 


\subsection{Vertical shear}\label{vshear_def}
Note that the disk is in general baroclinic with $\Omega =
\Omega(r,z)$. This is explicit from Eq. \ref{eqm_rot} and Eq. \ref{vertiso_eqm}, but is also 
implied by Eq. \ref{vert_equilibrium}---\ref{hori_equilibrium} and 
Eq. \ref{eqm_press},  
\begin{align}
  r\frac{\p\Omega^2}{\p z} = - \rho^{\Gamma-1}\frac{\p\ln\rho}{\p
    z}\frac{dK}{dr} = - \frac{g_z}{\Gamma}\frac{d\ln K}{dr}.\label{vertical_shear}
\end{align}
For the above disk models,
\begin{align}
  r\frac{\p\Omega^2}{\p z} = \frac{sz\Omega_k^2}{\Gamma
    r\left(1+z^2/r^2\right)^{3/2}}. \label{vertical_shear_ex} 
\end{align}
Note that there is a maximum vertical shear rate at $z=r/\sqrt{2}$,
which is expected to limit the growth rate of instabilities associated with vertical shear. 


\subsection{Stability condition against axisymmetric adiabatic
  perturbations}\label{solberg}
A rotating flow is stable against axisymmetric adiabatic perturbations
if both Solberg-Hoiland criteria  are satisfied:
\begin{align}
  \kappa^2 - \frac{1}{\rho c_p}\nabla P \cdot \nabla S &> 0,\\
  -\frac{\p P}{\p z}\left(\frac{\p j^2}{\p r}\frac{\p S}{ \p z} -
    \frac{\p j^2}{\p z}\frac{\p S}{\p r} \right)&>0. \label{second_SH} 
\end{align}
\citep{tassoul78}, where $j=r^2\Omega$ is the specific angular
momentum. For rotationally-supported, thin disks %  pressure gradients are small 
% compared to rotation, so 
the first criterion is generally satisfied. 
Thus, to assess stability, we consider the second
criterion. For our disk models,
\begin{align}
  &\frac{\p S}{\p r} = c_p\left[\frac{s}{\gamma r} +
    \left(\frac{\Gamma}{\gamma}-1\right)\frac{\p \ln{\rho}}{\p
       r}\right],\\
  &\frac{\p S}{\p z} = c_p
  \left(\frac{\Gamma}{\gamma}-1\right)\frac{\p \ln{\rho}}{\p z}. 
\end{align} 
Without loss of generality, we evaluate Eq. \ref{second_SH} in $z>0$
where $\p_zP<0$. Here we approximate $\p_r j^2\simeq r^3\Omega_k^2$ but
use Eq. \ref{vertical_shear} for $\p_zj^2$. Then 
\begin{align}\label{solberg2}
  % \gamma - \Gamma > \frac{s\epsilon^2}{\Gamma}
  % \left(\frac{\rho}{\rho_0}\right)^{\Gamma-1} \left[s
  %   -\left(\gamma-\Gamma\right)\frac{\p\ln{\rho}}{\p\ln{r}} \right]. 
  \gamma - \Gamma > \frac{\epsilon^2}{\Gamma}
  \left(\frac{\rho}{\rho_0}\right)^{\Gamma-1} \left[s^2
    -s\left(\gamma-\Gamma\right)\frac{\p\ln{\rho}}{\p\ln{r}} \right]
\end{align} 
implies stability. For typical model parameters the right hand
side (RHS) is $O(\epsilon^2)$. Hence, instability in the adiabatic limit  
requires $\gamma < \Gamma + O(\epsilon^2)$. Since we consider
$\epsilon\ll1$, this implies the equilibrium disk must have a small
entropy gradient in order to be unstable to axisymmetric adiabatic
perturbations. This is generally not true for passively irradiated, stably
stratified disks \citep{chiang97}, in which the VSI requires rapid
thermal relaxation, as shown below. 

\section{Linear problem}\label{linear}
We consider axisymmetric perturbations to the above equilibria in the
form 
\begin{align}
  \rho \to \rho(r, z) + \delta\rho(r,z)\exp{\left( - \ii\sigma
      t\right)},    
\end{align}
and similarly for other fluid variables, where $\sigma = \omega + \ii
\nu$ is a (generally) complex frequency, with $\omega$ and $\nu$ being
the real frequency and growth rate, respectively.

The linearized fluid equations in cylindrical co-ordinates are  
\begin{align}
  \ii\sigma\delta\rho &= \frac{\rho}{r}\frac{\p}{\p r}\left(r\delta v_r\right) + \frac{\p}{\p
    z}\left(\rho\delta v_z\right)  + \hat{g}_c\frac{\p\rho}{\p r}\delta v_r,\label{full_mass1}\\
  \ii\sigma\delta v_r &= \frac{1}{\rho}\frac{\p\delta P}{\p r} - 2\Omega
  \delta v_\phi - \hat{g}_c\frac{\delta\rho}{\rho^2}\frac{\p P}{\p r},\\ 
  \ii\sigma\delta v_\phi  &= \frac{\kappa^2}{2\Omega}\delta v_r +
  r\frac{\p\Omega}{\p z}\delta v_z,\\
  \ii \sigma\delta v_z &= \frac{1}{\rho}\frac{\p\delta P}{\p z} -
  \frac{\delta \rho}{\rho^2}\frac{\p P}{\p z},\\
  \ii\sigma\delta P &=\frac{\p P}{\p z}\delta v_z + \gamma P
  \left[\frac{1}{r}\frac{\p}{\p r}\left(r\delta v_r\right) + \frac{\p
      \delta v_z}{\p z}\right]\notag \\
  &+ \frac{1}{t_c}\left(\delta P -  
    \frac{P}{\rho}\delta\rho\right) + \hat{g}_c \frac{\p P}{\p r}\delta v_r,\label{full_energy1}
\end{align}
where the coefficients $\hat{g}_c=1$ are inserted to label terms
associated with the background radial disk structure. 

% This approach has been adopted
% in recent linear calculations of the VSI
% \cite{nelson13,mcnally14,barker15} because unstable modes have short
% radial lengthscales. 




\subsection{Radially-local approximation}  
We consider perturbations with small radial length-scales 
so that we can ignore the radial variations in the background
structure and radial gradients. \cite{barker15} have validated this
approximation by comparison with the linear VSI in global cylindrical
disk geometry. We thus evaluate all coefficients in
Eq. \ref{full_mass1}---\ref{full_energy1} at the fiducial radius
$r=r_0$. However, the full vertical dependence of the coefficients are
retained. Then we can assume perturbations have spatial dependence in
the form 
\begin{align}
  \delta \rho(r,z) \to \delta\rho(z)\exp{\ii k_r r}.
\end{align}
We take $k_r>0$ without loss of generality, and further assume $k_rr\gg1$ so that curvature terms can also be 
ignored.       

In order to emphasize the radially local approximation, we
introduce the local Cartesian co-ordinates $(x,y,z)$ corresponding to
the the local $(r,\phi,z)$ directions, respectively. Then writing
$\delta P /\rho \equiv W$ and $c_s^2\delta\rho/\rho\equiv Q$, the
linearized system of equations are 
\begin{align}
  \ii\sigma \frac{Q}{c_s^2}  &=  \ii k_x \delta v_x + \frac{d\dd
    v_z}{dz} + \frac{\p\ln{\rho}}{\p z}\delta v_z + \hat{g}_c
  \frac{\p\ln{\rho}}{\p r} \delta v_x,\label{lin_mass}\\
  \ii\sigma \delta v_x  &= \ii k_x W - 2\Omega\delta v_y -
  \hat{g}_c\frac{1}{\rho}\frac{\p P}{\p r}\frac{Q}{c_s^2}\label{lin_vx}\\
   \ii \sigma\delta v_y &= r\frac{\p \Omega}{\p z}\delta v_z +
  \frac{\kappa^2}{2\Omega}\delta v_x, \label{lin_vy}\\
   \ii\sigma\delta v_z &= \frac{dW}{dz} +
  \frac{\p\ln{\rho}}{\p z}\left(W-Q\right), \label{lin_vz}\\
  \ii \sigma W &= c_s^2\frac{\p\ln{\rho}}{\p z}\delta v_z +
  c_s^2\frac{\gamma}{\Gamma} \left(\ii k_x\delta v_x + \frac{d\delta
      v_z}{dz}\right) \notag\\
  &+ \frac{1}{t_c}\left(W - \frac{Q}{\Gamma}\right) +
  \hat{g}_c\frac{1}{\rho}\frac{\p P}{\p r}\delta v_x,\label{lin_energy}
  % -&\ii\sigma W + \frac{1}{t_c}\left(W-\frac{Q}{\Gamma}\right) = -\ii\sigma\frac{\gamma}{\Gamma} Q +
  % c_s^2\frac{d\ln{\rho}}{dz}\left(\frac{\gamma}{\Gamma}-1\right)\delta v_z.\label{lin_energy}
\end{align}
where we have made the notation change $k_r\to k_x$. 
It is understood that the quantities $\rho,\,c_s^2,\,\Omega,\kappa,\, 
\p_z\Omega,\, \p_r\ln{\rho} $ and $ \p_r P$ are evaluated at $r=r_0$
using their expressions in the global disk given in \S\ref{setup}. Thus, they are functions of $z$ only. 
Eq. \ref{lin_mass}---\ref{lin_energy} will form the basis of our numerical
study, but for analytical discussion
we will make further simplifications. 
