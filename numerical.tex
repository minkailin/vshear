\section{Numerical solutions}
In this section we numerically solve the linear stability problem
corresponding to Eq. \ref{lin_mass}---\ref{lin_energy}. 
We relax the thin-disk, low-frequency and nearly-Keplerian
approximations used in the discussion above, and 
use the full, non-Keplerian expressions of $\rho$, $\Omega$ and
$\kappa$, so that we may consider vertical domains up to $z\sim r$.  

% \subsection{Boundary conditions}
% In numerical calculations a finite vertical domain $z\in[-1,1]\zmax$
% is adopted. For $\Gamma\neq1$ we take $\zmax$ to be slightly less than
% $H$ to avoid the zero-density surface. At $z=\pm\zmax$ we impose
% \begin{align}
%   \delta v_z = 0,
% \end{align}
% for a solid boundary, or 
% \begin{align}
%   \Delta P \equiv \delta P + \bm{\xi}\cdot\nabla P= 0,  
% \end{align}
% for a free surface, where $\bm{\xi}$ is the Lagrangian
% displacement.

We solve the linear problem by expanding the
perturbations in Chebyshev polynomials $T_l$ up to $l=512$
and discretizing the equations on a grid with
$z\in[-\zmax,\zmax]$. At the vertical boundaries we impose a free
surface, 
\begin{align}
  \Delta P \equiv \delta P + \bm{\xi}\cdot\nabla P= 0 \quad \text{at } z=\pm\zmax,
\end{align}
where $\bm{\xi}$ is the Lagrangian displacement. This boundary
condition was found to be most convenient for numerical
implementation. The above discretization procedure converts the linear  
system of differential equations to a standard matrix eigenvalue
problem.     

Unless otherwise stated, our fiducial disk model is a
nearly-vertically isothermal disk with $\Gamma=1.011$, $p=-1.5$,
$q=-1$, $\epsilon=0.1$, and the perturbation wavenumber $k_x = 200\pi/r$
(or $\hat{k}=20\pi$). 


\subsection{VSI in a neutrally stratified disk}\label{vertiso_pertiso} 
We first test our numerical code, as well as the discussion in
\S\ref{iso_discuss}, by considering nearly-isothermal
perturbations. We set $\gamma=1.011=\Gamma$, and effectively switch
off thermal relaxation by choosing $\beta=10^9$. The vertical domain is
$\zmax = 10\epsilon r$. This setup is very similar to that adopted in
\cite{mcnally14}, who calculated the VSI in vertically isothermal
disks subject to isothermal perturbations ($\Gamma=\gamma=1$).  


Fig. \ref{lowfreq_eigen} shows the eigenvalues $\sigma = \omega +
\ii\nu$. This plot is effectively identical to that in
\cite{mcnally14}. The fundamental VSI mode, with one node in $W$, has
the smallest $|\sigma|$ and is shown in Fig. \ref{lowfreq_eigenfunc}.  
Its expected growth rate, calculated from Eq. \ref{simple_growth} with  
$L=1$, and the numerically-obtained value are 
\begin{align*}
  \nu = 0.2606\epsilon\Omega_k &\quad \text{(from
    Eq. \ref{simple_growth})},\\
  \nu = 0.2577 \epsilon \Omega_k &\quad \text{(numerical)}.
\end{align*}
This agreement is surpsingly good, given that
Eq. \ref{simple_growth} assumes a thin, nearly-Keplerian disk in the 
low-frequency approximation, and
imposes a different boundary condition to that in the numerical
calculation. The eigenfrequency is not very sensitive to the vertical boundary
condition because the expression for $\sigma$, given by
Eq. \ref{integral_relation1}, involve integrands with $\rho$ as the 
weight function, which rapidly decays away from the midplane. The
eigenfunction $W$ is qualitatively proportional to 
$z$, as expected for the fundamental mode according to explicit
solutions discussed in \S\ref{iso_poly}.    

\begin{figure}
  \includegraphics[width=\linewidth]{figures/eigenvalues_iso}
  \caption{Eigenvalues of the
    vertical shear instability in a neutrally-stratified,
    nearly-vertically isothermal disk  ($\gamma=\Gamma=1.011$). The
    disk parameters are $q=-1$,  
    $p=-1.5$ and $\epsilon=0.1$, while the perturbation radial
    wavenumber is $k_x=200\pi/r$. This is the set up considered in
    \cite{mcnally14}. \label{lowfreq_eigen}
  }
\end{figure}

\begin{figure}
  \includegraphics[width=\linewidth]{figures/eigenvector_iso}
  \caption{Eigenfunction of the fundamental VSI,
    corresponding to the bottom-left eigenvalue displayed in
    Fig. \ref{lowfreq_eigen} (smallest $|\sigma|$). The
    solid and dashed lines are $\real W$ and $\imag W$, respectively. 
    \label{lowfreq_eigenfunc}
  }
\end{figure}

We have also solved this problem with in the low-frequency 
approximation by setting $D\to\kappa^2$ in Eq. \ref{iso_ode}. We
obtained very similar results, as expected for modes with
$|\sigma/\Omega_k|\ll1$. 

\subsection{Stabilization of the VSI by a positive vertical entropy
  gradient}
We demonstrate the (strong) stabilizing effect of a  
positive vertical entropy gradient by setting $\gamma=2$.  
Since we expect the perturbations to decay rapidly
away from the midplane (see \S\ref{analytic_adia}), we consider a
smaller domain with $\zmax = 2\epsilon r$. 
Other disk and perturbation parameters are the same as in
\S\ref{vertiso_pertiso}.    

% We use the same pseudo-spectral method as before. Here we set
% $\zmax = 2\epsilon r$ and impose a free surface. This boundary
% condition was found to be most convenient for numerical
% implementation. Since we expect the perturbations to decay rapidly
% away from the midplane (see \S\ref{analytic_adia}), we do not expect 
% boundary conditions to play an important role, provided that $\zmax$ is
% sufficiently large. 

Fig. \ref{lowfreq_eigen_adia} show the eigenvalues for this
problem. The growth rates are about an order of magnitude smaller than
the previous case. The fundamental VSI mode is that with
$\mathrm{max}|\nu|$. Its expected and numerically-calculated growth
rates compares well, with 
\begin{align*}
  \nu = 0.03751 \epsilon \Omega_k &\quad \text{(from
    Eq. \ref{gam2_growth_rate})},\\
  \nu = 0.03672 \epsilon \Omega_k &\quad \text{(numerical)}.
\end{align*}
The fundamental mode is plotted in Fig. \ref{lowfreq_eigenfunc_adia},
and clearly show that perturbations are rapidly stabilized away from
the midplane. For the adopted disk and perturbation parameters 
($|q|=1$ and $\hat{k} = 20\pi$), Eq. \ref{gam2_alpha} gives $\real{\alpha}\simeq - 43.8$,
corresponding to a characteristic decay length scale of $\simeq
0.15\epsilon r$, which is consistent with that observed in 
Fig. \ref{lowfreq_eigenfunc_adia}. 

Note that the decay lengthscale is rougly the height within which
vertical shear is larger than the buoyancy frequency squared. That is,
\begin{align*}
\left|r\frac{d\Omega^2}{dz}\right|\gtrsim N_z^2
\end{align*}
for
\begin{align*}
  \left|\frac{z}{\epsilon r}\right| \lesssim \frac{\epsilon|q|\gamma}{\gamma-1},
\end{align*}
in a thin, vertically isothermal disk. This evaluates to $z\sim
0.2\epsilon r$ for the current disk model, consistent with
Fig. \ref{lowfreq_eigenfunc_adia}. 

Furthermore, the growth rate to should be no larger than the
maximum vertical shear available within this decay lengthscale. Using 
Eq. \ref{max_growth} as a rough guide, 
\begin{align}
  \frac{\nu}{\epsilon\Omega_k}<\frac{\epsilon |q|^2\gamma}{2(\gamma-1)},
\end{align}
or $\nu< 0.1\epsilon\Omega_k$ is expected in our disk model,
consistent with numerical results. 


\begin{figure}
  \includegraphics[width=\linewidth]{figures/eigenvalues_adia}
  \caption{Eigenvalues in for the
    vertical shear instability in a nearly-vertically isothermal disk
    ($\Gamma=1.011$) evolved adiabatically with $\gamma=2$ and
    $\beta=10^9$. The disk
    parameters are $q=-1$, 
    $p=-1.5$ and $\epsilon=0.1$, while the perturbation radial
    wavenumber is $k_x=200\pi/r$. \label{lowfreq_eigen_adia}
  }
\end{figure}
  

\begin{figure}
  \includegraphics[width=\linewidth]{figures/eigenvectorvz_adia}
  \caption{Fundamental VSI mode in a nearly-vertically
    isothermal disk ($\Gamma=1.011$) evolved adiabatically
    ($\gamma=2$, $\beta=10^9$). This eigenfunction 
    corresponds to the top-left eigenvalue displayed in 
    Fig. \ref{lowfreq_eigen_adia} (largest $|\nu|$).  
    The solid and dashed lines are $\real \delta v_z$ and $\imag
    \delta v_z$, respectively.  
    \label{lowfreq_eigenfunc_adia}
  }
\end{figure}


We have also solved this problem in the low-frequency approximation
using Eq. \ref{ode_w}---\ref{ode_Q} with the replacement
$D\to\kappa^2$. We again obtained very similar results. 

\subsection{Effect of thermal relaxation}
{\bf vertical isothermal disk with tcool}

\subsection{Vertically non-isothermal disks}
{\bf big gamma > 1, with tcool} 